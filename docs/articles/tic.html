<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting started with CI for R • tic</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting started with CI for R">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tic</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.2.13.9008</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/tic.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/tic-advantages.html">tic advantages</a>
    </li>
    <li>
      <a href="../articles/tic-usethis-travis.html">tic, travis and usethis</a>
    </li>
    <li>
      <a href="../articles/build-lifecycle.html">Build lifecycle</a>
    </li>
    <li>
      <a href="../articles/advanced.html">Advanced usage</a>
    </li>
    <li>
      <a href="../articles/deployment.html">How deployment works</a>
    </li>
    <li>
      <a href="../articles/custom-steps.html">Dev - custom steps</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ropenscilabs/tic">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Getting started with CI for R</h1>
                        <h4 class="author">Patrick Schratz, Kirill Müller</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropenscilabs/tic/blob/master/vignettes/tic.Rmd"><code>vignettes/tic.Rmd</code></a></small>
      <div class="hidden name"><code>tic.Rmd</code></div>

    </div>

    
    
<div id="prerequisites" class="section level1">
<h1 class="hasAnchor">
<a href="#prerequisites" class="anchor"></a>Prerequisites</h1>
<p>If you are unfamiliar with the term Continuous Integration (CI), we highly recommend to read the following resources:</p>
<ul>
<li><a href="https://ropensci.github.io/dev_guide/ci.html" class="uri">https://ropensci.github.io/dev_guide/ci.html</a></li>
<li><a href="https://juliasilge.com/blog/beginners-guide-to-travis/" class="uri">https://juliasilge.com/blog/beginners-guide-to-travis/</a></li>
<li><a href="http://mahugh.com/2016/09/02/travis-ci-for-test-automation/" class="uri">http://mahugh.com/2016/09/02/travis-ci-for-test-automation/</a></li>
</ul>
<p>The advantages of using <code>tic</code> for R-related CI workflows are:</p>
<ul>
<li>CI-agnostic workflow definitions (in R!)</li>
<li>Simplified deployment (e.g. automatic deployment of a <code>pkgdown</code> site for a R package)</li>
<li>Improved package checking via <a href="https://github.com/r-lib/rcmdcheck">rcmdcheck</a>
</li>
<li>Robust caching approach</li>
</ul>
<p>A more comprehensive summary of all advantages can be found in the <a href="tic-advantages.html">tic-advantages</a> vignette.</p>
</div>
<div id="initialization" class="section level1">
<h1 class="hasAnchor">
<a href="#initialization" class="anchor"></a>Initialization</h1>
<p>The easiest way to use <code>tic</code> for CI services is to call <code>usethis::use_ci()</code>. This will create templates for both “Travis CI” and “Appveyor” and initialize all the required authentication steps for deployment. During the process, browser pages will open app ensuring that all permissions are set correctly and all apps are authorized. Also a Personal Access Token (PAT) will be created for Travis, using a private Github PAT variable. Read <a href="https://itsalocke.com/blog/using-travis-make-sure-you-use-a-github-pat/">here</a> why this is important. Note that this procedure cannot be fully automated currently.</p>
<p>[ADD CODE OUTPUT OF use_ci()]</p>
<p>The functionality is integrated in the <a href="http://usethis.r-lib.org/"><code>usethis</code></a> package because it contains various other useful <code>use_*</code> functions that simplify R (package) development. However, the heavy lifting in the background is actually done by the R packages <code>travis</code> and <code>tic</code>. See <a href="tic-usethis-travis.html">here</a> for more detailed information on how <code>tic</code>, <code>travis</code> and <code>usethis</code> work together.</p>
</div>
<div id="explanation-of-the-basic-template" class="section level1">
<h1 class="hasAnchor">
<a href="#explanation-of-the-basic-template" class="anchor"></a>Explanation of the basic template</h1>
<p>After having called <code>usethis::use_ci()</code> you will find a <code>.travis.yml</code>, <code>appveyor.yml</code> and a <code>tic.R</code> file in your repo. Usually you do not need to touch <code>appveyor.yml</code> and <code>.travis.yml</code> anymore. All build customizations are done in <code>tic.R</code> and apply to both services. If you want more information about the whole build lifecycle, check the <a href="build-lifecycle.html">Build lifecycle</a> vignette.</p>
<p>The basic <code>tic.R</code> template looks as follows:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="../reference/DSL.html">add_package_checks</a></span>(<span class="dt">warnings_are_errors =</span> (<span class="kw">getRversion</span>() <span class="op">&gt;=</span><span class="st"> "3.2"</span>))</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="cf">if</span> (<span class="kw">Sys.getenv</span>(<span class="st">"BUILD_PKGDOWN"</span>) <span class="op">!=</span><span class="st"> ""</span>) {</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">  <span class="kw"><a href="../reference/DSL.html">get_stage</a></span>(<span class="st">"before_deploy"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="st">    </span><span class="kw"><a href="../reference/DSL.html">add_step</a></span>(<span class="kw"><a href="../reference/step_setup_ssh.html">step_setup_ssh</a></span>())</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1-7" data-line-number="7">  <span class="kw"><a href="../reference/DSL.html">get_stage</a></span>(<span class="st">"deploy"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="st">    </span><span class="kw"><a href="../reference/DSL.html">add_step</a></span>(<span class="kw"><a href="../reference/step_push_deploy.html">step_push_deploy</a></span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="st">    </span><span class="kw"><a href="../reference/DSL.html">add_step</a></span>(<span class="kw"><a href="../reference/step_build_pkgdown.html">step_build_pkgdown</a></span>())</a>
<a class="sourceLine" id="cb1-10" data-line-number="10">}</a></code></pre></div>
<p>Let’s break done what happens here:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="../reference/DSL.html">add_package_checks</a></span>(<span class="dt">warnings_are_errors =</span> (<span class="kw">getRversion</span>() <span class="op">&gt;=</span><span class="st"> "3.2"</span>))</a></code></pre></div>
<p>Is a convenient function which adds essential steps to various stages of a CI run. For example, it adds <code>utils::update_packages(ask = FALSE)</code> to the “before_install” stage. Check <code>?add_package_checks()</code> to see a list of all added steps by this wrapper function.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="cf">if</span> (<span class="kw">Sys.getenv</span>(<span class="st">"BUILD_PKGDOWN"</span>) <span class="op">!=</span><span class="st"> ""</span>) { }</a></code></pre></div>
<p>This line conditions its contents on the existence of the environment variable <code>"BUILD_PKGDOWN"</code>. The env variable is set in <a href="https://github.com/ropenscilabs/tic/blob/d3c9ffab7e42ef4bf0a3113337c42dbaf592146c/.travis.yml#L45-L47"><code>.travis.yml</code></a>, conditioned on the job that runs on the current R-release version:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode yml"><code class="sourceCode yaml"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">-</span> <span class="fu">r:</span><span class="at"> release</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="fu">env:</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"> <span class="kw">-</span> BUILD_PKGDOWN=true</a></code></pre></div>
<p>If the if-condition evaluates to <code>TRUE</code>, the following is executed. Function <code><a href="../reference/step_setup_ssh.html">step_setup_ssh()</a></code> sets up the SSH connection needed for deployment.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="../reference/DSL.html">get_stage</a></span>(<span class="st">"before_deploy"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/DSL.html">add_step</a></span>(<span class="kw"><a href="../reference/step_setup_ssh.html">step_setup_ssh</a></span>())</a></code></pre></div>
<p>Then, in the “deploy” stage of the CI run, function <code><a href="../reference/step_build_pkgdown.html">step_build_pkgdown()</a></code> will build a <a href="http://pkgdown.r-lib.org/"><code>pkgdown</code></a> site if the project is an R package.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="../reference/DSL.html">get_stage</a></span>(<span class="st">"deploy"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/DSL.html">add_step</a></span>(<span class="kw"><a href="../reference/step_build_pkgdown.html">step_build_pkgdown</a></span>())</a></code></pre></div>
</div>
<div id="examples-projects" class="section level1">
<h1 class="hasAnchor">
<a href="#examples-projects" class="anchor"></a>Examples projects</h1>
<p><code>tic</code> can be used for various R projects (see below).</p>
<ul>
<li><a href="https://github.com/krlmlr/tic.blogdown">tic.blogdown</a></li>
<li><a href="https://github.com/krlmlr/tic.bookdown">ŧic.bookdown</a></li>
<li><a href="https://github.com/krlmlr/tic.drat">tic.drat</a></li>
<li><a href="https://github.com/krlmlr/tic.package">tic.package</a></li>
<li><a href="https://github.com/krlmlr/tic.website">tic.website</a></li>
<li>
<a href="https://github.com/krlmlr/tic.figshare">tic.figshare</a>.</li>
</ul>
<p>As an example, we explain a “blogdown” project in more detail. <a href="https://bookdown.org/yihui/blogdown/"><code>blogdown</code></a> is a R package for publishing websites. Under the hood, it uses the framework <a href="https://gohugo.io/">HUGO</a> which gets installed by the respective <code>tic.R</code> <a href="https://github.com/krlmlr/tic.blogdown/blob/975aedd43fec1dd55e8348eccfca2c7c5f663006/tic.R#L5">template</a> in the “install” section:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="../reference/DSL.html">get_stage</a></span>(<span class="st">"install"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/DSL.html">add_code_step</a></span>(blogdown<span class="op">::</span><span class="kw">install_hugo</span>(), <span class="dt">prepare_call =</span> remotes<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/remotes/topics/install_github">install_github</a></span>(<span class="st">"rstudio/blogdown"</span>))</a></code></pre></div>
<p>Then the website is build and deployed. The <code>blogdown::build_site()</code> function for websites is the equivalent to <code><a href="http://pkgdown.r-lib.org/reference/build_site.html">pkgdown::build_site()</a></code> for R packages.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="../reference/DSL.html">get_stage</a></span>(<span class="st">"deploy"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="st">    </span><span class="kw"><a href="../reference/DSL.html">add_code_step</a></span>(blogdown<span class="op">::</span><span class="kw">build_site</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="st">    </span><span class="kw"><a href="../reference/DSL.html">add_step</a></span>(<span class="kw"><a href="../reference/step_push_deploy.html">step_push_deploy</a></span>())</a></code></pre></div>
<p>You see, steps and stages differ between projects (here between a “blogdown” website and a “package”). <code>tic</code> is smart enough to detect your project automatically when calling <code>usethis::use_ci()</code> and will add the correct template.</p>
<p><strong>Note:</strong> Currently, publishing to <a href="https://figshare.com/" class="uri">https://figshare.com/</a> doesn’t work. Also, publishing to <a href="https://zenodo.org/" class="uri">https://zenodo.org/</a> is work in progress.</p>
</div>
<div id="advanced" class="section level1">
<h1 class="hasAnchor">
<a href="#advanced" class="anchor"></a>Advanced</h1>
<p>The advanced usage of <code>tic</code> is described in more detail in article <a href="advanced.html">Advanced Usage</a>:</p>
<ul>
<li><a href="advanced.html#pkgdown-deployment">Options for <code>pkgdown</code> deployment</a></li>
<li><a href="advanced.html#using-travis-ci-meta-information">Using Travis CI Meta-information</a></li>
<li><a href="advanced.html#troubleshooting-running-tic-locally">Troubleshooting: Running <code>tic</code> locally</a></li>
<li><a href="advanced.html#troubleshooting-running-tic-locally">Troubleshooting: Enter into the Travis build</a></li>
<li><a href="custom-steps.html">Writing custom steps</a></li>
</ul>
<p>The build lifecycle when using <code>tic</code> is explained in detail <a href="build-lifecycle.html">here</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#prerequisites">Prerequisites</a></li>
      <li><a href="#initialization">Initialization</a></li>
      <li><a href="#explanation-of-the-basic-template">Explanation of the basic template</a></li>
      <li><a href="#examples-projects">Examples projects</a></li>
      <li><a href="#advanced">Advanced</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Kirill Müller, Mika Braginsky, Karthik Ram, Jeroen Ooms, Patrick Schratz, rOpenSci.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
